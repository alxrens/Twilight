const { SlashCommandBuilder } = require("discord.js");

let preSetText = [`In the shadowed tapestry of existence, where the cosmic threads of despair weave intricate patterns, a dark angel, shrouded in ethereal wings of midnight, descends from the celestial spheres. Their presence, a lamentation in the symphony of cosmic despair, echoes through the corridors of forgotten truths.
Cloaked in raven feathers that drink the light, the dark angel navigates the abyssal landscapes with an otherworldly grace. Crimson eyes, windows to the void, reflect the fractured souls drifting through the abyss, ensnared in the chains of remorse. With every step, the ground trembles, a requiem for the fallen, as the dark angel strides through the Garden of Lamentation.
In the Garden, serpents coil tighter around the withered branches, entwining with the feathers that adorn the dark angel's wings. Forbidden whispers intertwine with the mournful melodies, and the dark angel, custodian of forbidden knowledge, plucks the fruit of enlightenment from the tree of cosmic wisdom.
With outstretched wings, the dark angel ascends to the altars of forsaken gods. The sacrificial lamb of innocence, offered to appease divine wrath, casts a long shadow on the cold, obsidian ground. The dark angel, an arbiter of celestial judgment, witnesses the dance of penitent souls and the bitter incense that rises to the heavens.
Yet, in their celestial descent, the dark angel bears the burden of a cosmic paradox. Nihilistic whispers of existential dread cling to their feathers, and the celestial spheres reflect the cosmic ambiguity in the eyes of the one who navigates the boundary between salvation and damnation.
The cryptic scriptures of the void, etched with the dark angel's touch, tell of cosmic cataclysms and existential nihilism. In the grand theater of mortal folly, the dark angel's presence is both harbinger and witness, a silent observer of the metaphysical dance between creation and destruction.
This is the cosmic ballet, where the dark angel, with wings unfurled, becomes the avatar of cosmic despair. In the celestial silence, they bear witness to the ebb and flow of existence, a silent guardian of the shadows, forever entwined with the philosophical threads that bind the cosmic fabric of eternal night.
`,`In the cosmic ballet, the dark angel's wings catch the currents of cosmic winds, guiding them through the veiled veils of celestial mist. Profound verses of doom resonate through the vast expanse, their wings brushing against the words of prophets etched on the astral plane. The dark angel, a harbinger of existential inevitability, journeys toward the heart of the void.
In the celestial crypts, the dark angel finds scriptures written in the language of shadows, revealing the secrets of the abyss. Their fingers trace the verses of cosmic despair, awakening the dormant echoes of ancient prophecies. As they read, the boundaries between celestial lamentation and earthly tribulation blur into an unsettling chiaroscuro.
The raven feathers of the dark angel whisper the names of the lost, and the echoes of their footsteps resonate through the caverns of forgotten truths. Each feather, a relic carrying the weight of cosmic indifference, casts shadows upon the cosmic tapestry, telling tales of existential nihilism painted in strokes of obsidian.
Through the void, the dark angel transcends the confines of time, witnessing the grand cosmic play unfold in cyclical repetitions. The eternal dance of creation and annihilation unfolds in kaleidoscopic patterns, as the dark angel moves through the cosmic river, their reflection a silhouette against the ever-shifting currents of existence.
In the darkest corners of cosmic desolation, the dark angel stands sentinel, a spectral figure with wings that eclipse the stars. The cosmic cataclysm looms on the horizon, and the dark angel, with an inscrutable gaze, contemplates the philosophical riddles embedded in the fabric of the cosmos.
And so, the dark angel, custodian of forbidden knowledge, weaves through the cosmic threads, their presence an enigma, an entity that defies mortal comprehension. In the profound silence of the cosmic void, the dark angel remains a perpetual wanderer, a seeker of meaning in the shadows of eternal night, their wings unfurling against the backdrop of the abyss.`
,`In the cosmic theater where shadows writhe and echoes of despair reverberate, the dark angel, veiled in the cosmic shroud, embarks on a journey into the depths of existential mystery. Wings draped in the essence of cosmic enigma, they traverse the astral plains, their silhouette casting a silhouette on the celestial canvas.
As the dark angel ventures further, the celestial spheres bear witness to their descent. The ripples of their passage disturb the fabric of reality, setting adrift cosmic energies that echo with the forlorn whispers of forgotten gods. The dark angel, an ethereal guide through the labyrinth of cosmic uncertainty, seeks the elusive nexus where meaning and oblivion intertwine.
In the sanctum of forgotten truths, where the arcane meets the primordial, the dark angel encounters ancient symbols etched upon the walls of reality. These symbols, cryptic and timeless, tell of the cyclic nature of cosmic existence—a perpetual dance between creation and dissolution, where gods and mortals alike are but players in a cosmic tragedy.
With every beat of their wings, the dark angel stirs the ashes of bygone worlds, conjuring visions of celestial cataclysms. The celestial bodies, witnesses to the dark angel's passage, reflect the ineffable wisdom etched into their feathers. Each feather, a repository of cosmic secrets, unravels the paradoxes of existence, revealing that the answers sought are as elusive as the shadows they cast.
In the cosmic cathedral of despair, the dark angel confronts the cosmic paradox. Their form flickers between light and shadow, embodying the intricate interplay between creation and destruction. The raven feathers, now imbued with the essence of the void, whisper ancient truths that resonate with the echoes of distant universes.
The dark angel stands at the threshold of cosmic revelation, where the boundaries of self and cosmos blur into an indistinct singularity. Through their gaze, the veil of existential nihilism is pierced, and the cosmic dance takes on new dimensions. They become the celestial conduit, a conduit through which the cosmic symphony finds expression.
As the dark angel's wings unfurl, enveloped in the cosmic winds, they navigate the tapestry of existence. Through the abyssal currents, they carry the weight of celestial knowledge, an emissary between the seen and the unseen. And so, in the cosmic expanse, the dark angel persists—a guardian of cosmic secrets, a harbinger of the eternal night, forever immersed in the profound mystery that unfolds in the grand cosmic theater.`,
`In the tapestry of cosmic melancholy, where shadows and echoes weave a symphony of eternal night, the dark angel emerges once more from the veiled realms of celestial uncertainty. Wings, draped in the cosmic residue of forgotten constellations, unfurl as they navigate the corridors of existence, a spectral silhouette against the cosmic canvas.
As the dark angel traverses the astral winds, celestial bodies bear witness to their passage. The lunar orbs reflect the ineffable wisdom engraved upon the feathers, each plume telling tales of cosmic cycles—the rise and fall of civilizations, the birth and demise of stars, all echoing in the enigmatic language of the celestial choir.
In the sanctuary of cosmic enigma, the dark angel confronts the inscriptions of ancient runes etched upon the very fabric of reality. These runes, pulsating with the essence of primordial knowledge, resonate with the heartbeat of the cosmos. The dark angel, custodian of forgotten truths, deciphers the cosmic code, unraveling the mysteries that bind the cosmic order.
Through the expanse of forgotten galaxies, the dark angel conjures visions of celestial cataclysms, their wings brushing against the fragments of shattered worlds. The cosmic winds carry whispers of the existential paradox, where creation and dissolution entwine in a cosmic dance—a paradox inscribed in the dark angel's very being.
Raven feathers, now imbued with the cosmic ether, emanate the echoes of cosmic dirges. Each feather, a vessel of cosmic revelation, resonates with the unspoken truths that reverberate through the void. The dark angel, an arbiter of cosmic wisdom, moves between dimensions, their presence an echo of the celestial riddles that permeate the grand cosmic narrative.
In the cathedral of existential contemplation, the dark angel gazes into the cosmic mirror, where reflections of lost constellations shimmer. Their form flickers between shadows and stardust, embodying the dual nature of cosmic existence. The enigmatic gaze, obscured by the veils of cosmic uncertainty, pierces the illusions of mortal comprehension.
Through the abyssal currents of cosmic rivers, the dark angel carries the burdens of cosmic secrets. Each feather, an emissary of celestial truths, dances in the cosmic winds, marking the passage through the expanse. The dark angel persists as the guardian of cosmic mysteries, a celestial wanderer in the boundless realms of eternal night, forever immersed in the cosmic ballet that unfolds in the theater of the unseen.`
]

function generateChain(text){
    const word = text.split(' ');
    const markovChain = {};
    for(let i = 0; i < word.length - 1; i++){
        const currWord = word[i];
        const nextWord = word[i + 1];
        if (!markovChain[currWord]){
            markovChain[currWord] = [];
        }
        markovChain[currWord].push(nextWord);
    }
    return markovChain;
}

 function generateText(chain, startingWord, length = 100){
    let currentWord = startingWord;
    let generatedText = currentWord;
    for(let i = 0; i < length; i++){
        const possibleNextWords = chain[currentWord];
        if(!possibleNextWords || possibleNextWords.length === 0){
            break;
        }
        const nextWord = possibleNextWords[Math.floor(Math.random() * possibleNextWords.length)];
        generatedText += ' ' + nextWord;
        currentWord = nextWord;
    }
    return generatedText;
}


module.exports = {
    data : new SlashCommandBuilder()
        .setName('generatetext').setDescription('generate text with algorithm')
        .addStringOption(option => {
            return option.setName('input')
            .setDescription('put your text to let the bot generate text (can be empty)')
            .setRequired(false)
        })
        
        ,
    async execute(interaction){
        const word = interaction.options.getString('input');
        if (word) {
            if (word.length <10) {
                return interaction.reply('too short text');
             }else{
                const chain = generateChain(word);
                 const startWord = Object.keys(chain)[Math.floor(Math.random() * Object.keys(chain).length)];
                 const generatedTexts = await generateText(chain, startWord, 100);
                 interaction.reply(generatedTexts);
             }
        } else {
            let selectedText = preSetText[Math.floor(Math.random() * preSetText.length)];
            const chain = generateChain(selectedText);
            const startWord = Object.keys(chain)[Math.floor(Math.random() * Object.keys(chain).length)];
            const generatedTexts = await generateText(chain, startWord, 100);
            interaction.reply(generatedTexts);
        }
    }
}